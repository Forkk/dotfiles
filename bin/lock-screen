#!/usr/bin/env bash
# Pretty lock screen. Requires i3lock-color from
# https://github.com/Raymo111/i3lock-color

set -euf -o pipefail

COLOR_BG0="282828";
COLOR_BG1="3c3836";
COLOR_BG2="504945";
COLOR_BG3="665c54";
COLOR_BG4="7c6f64";
COLOR_FG4="a89984";
COLOR_FG3="bdae93";
COLOR_FG2="d5c4a1";
COLOR_FG1="ebdbb2";
COLOR_FG0="fbf1c7";

COLOR_GREEN="b8bb26";
COLOR_RED="fb4934";
COLOR_YELLOW="fabd2f";
COLOR_BLUE="83a598";
COLOR_ORANGE="fe8019";
COLOR_PURPLE="d3869b";
COLOR_AQUA="8ec07c";

RING_ALPHA="ff"
INNER_ALPHA="aa"


COLOR_TEXT="$COLOR_BG0"

COLOR_NORMAL="$COLOR_AQUA"
COLOR_VERIFY="$COLOR_GREEN"
COLOR_WRONG="$COLOR_RED"
COLOR_TYPING="$COLOR_ORANGE"
COLOR_BACKSPACE="$COLOR_RED"


FONT="Source Code Pro"

# Image displayed on lock screen.
IMAGE="$HOME/wallpaper/current"

# Display off timeout during lock screen.
DISP_TIMEOUT=30

revert() {
    # Disable display timeout
    xset -dpms
}
# Unset display timeout on exit no matter what.
trap revert SIGHUP SIGINT SIGTERM
# Enable display timeout.
xset +dpms dpms "$DISP_TIMEOUT"

if pgrep picom > /dev/null; then
    BG_ARGS='--color=00000022'
else
    BG_ARGS='--blur=6'
fi

GREETER_POS="w/2:400"
# HACK on homebase to move the greeter to the right monitor.
if [ "$(hostname)" == "homebase" ] && xrandr | grep '1920x1080 *60\.00\*' >/dev/null; then
    GREETER_POS="w*1.5:420"
fi


i3lock --nofork --centered $BG_ARGS \
    --ignore-empty-password --radius="120" \
    --veriftext="verifying" --wrongtext="denied" --noinputtext="no input" \
        --time-font="$FONT" --date-font="$FONT" --verif-font="$FONT" \
        --wrong-font="$FONT" \
        --timecolor="$COLOR_TEXT" --datecolor="$COLOR_TEXT" \
        --verifcolor="$COLOR_TEXT" \ --wrongcolor="$COLOR_TEXT" \
    --greetertext="welcome to $(hostname)" \
        --greeterpos="$GREETER_POS" \
        --greetercolor="${COLOR_AQUA}ff" \
        --greeter-font="$FONT" \
    --indicator \
        --insidecolor="$COLOR_NORMAL$INNER_ALPHA" \
        --insidevercolor="$COLOR_VERIFY$INNER_ALPHA" \
        --insidewrongcolor="$COLOR_WRONG$INNER_ALPHA" \
        --ringcolor="$COLOR_NORMAL$RING_ALPHA" \
        --ringvercolor="$COLOR_VERIFY$RING_ALPHA" \
        --ringwrongcolor="$COLOR_WRONG$RING_ALPHA" \
        --line-uses-ring \
        --keyhlcolor="${COLOR_TYPING}ff" \
        --bshlcolor="${COLOR_BACKSPACE}ff" \
        --separator="00000000" \
    --clock \
        --datestr="%A, %b %d, %Y"

revert

